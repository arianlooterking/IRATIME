<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TimeGuard — Employee</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0a0a0a; color:#f5f5f5; margin:0; }
    header { padding:16px; background:#111; }
    main { padding:16px; max-width:720px; margin:0 auto; }
    input, button { padding:12px; border-radius:8px; border:1px solid #333; background:#111; color:#f5f5f5; }
    button { cursor:pointer; margin-right:8px; }
    .row { display:flex; gap:8px; margin-bottom:12px; }
    .card { border:1px solid #222; border-radius:12px; padding:16px; background:#0f0f0f; margin-bottom:12px; }
    .ok { color:#25d366; } .err { color:#ff5252; } .muted { color:#bbb; }
  </style>
</head>
<body>
  <header><strong>TimeGuard</strong> — Employee</header>
  <main>
    <div class="card">
      <div class="row">
        <input id="name" placeholder="Full name">
        <input id="phone" placeholder="Phone (optional)">
      </div>
      <div class="row">
        <button id="register">Register / Link Device</button>
        <span class="muted">Device: <code id="dev"></code></span>
      </div>
      <div id="regResult"></div>
    </div>

    <div class="card">
      <p><small>Wi-Fi allow-list only (no location). Must be on shop Wi-Fi if PUBLIC_IPS is set.</small></p>
      <div class="row">
        <button id="checkin">Check In</button>
        <button id="breakstart">Break Start</button>
        <button id="breakend">Break End</button>
        <button id="checkout">Check Out</button>
      </div>
      <div id="eventResult"></div>
    </div>
  </main>

<script>
const base = ''; // same domain
const devId = localStorage.getItem('tg_device_uuid') || crypto.randomUUID();
localStorage.setItem('tg_device_uuid', devId);
document.getElementById('dev').textContent = devId;

async function postJSON(path, body) {
  const res = await fetch(base + path, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
  const txt = await res.text();
  try { return { status: res.status, json: JSON.parse(txt) }; } catch(e) { return { status: res.status, json: { raw: txt } }; }
}
document.getElementById('register').onclick = async () => {
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const r = await postJSON('/api/auth/register', { name, phone, platform: navigator.userAgent, device_uuid: devId });
  document.getElementById('regResult').innerHTML = r.status === 200 ? '<span class="ok">✅ Registered</span>' : '<span class="err">❌ ' + (r.json.error||r.status) + '</span>';
};
async function sendEvent(endpoint) {
  const r = await postJSON('/api/events/' + endpoint, { device_uuid: devId, source: 'manual' });
  document.getElementById('eventResult').innerHTML = r.status === 200 ? '<span class="ok">✅ ' + endpoint + ' recorded</span>' : '<span class="err">❌ ' + (r.json.error||r.status) + '</span>';
}
document.getElementById('checkin').onclick = () => sendEvent('check-in');
document.getElementById('breakstart').onclick = () => sendEvent('break-start');
document.getElementById('breakend').onclick = () => sendEvent('break-end');
document.getElementById('checkout').onclick = () => sendEvent('check-out');
</script>
</body>
</html>